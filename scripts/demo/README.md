# Demo Scripts

This directory contains demo-specific scripts for preparing and executing live demonstrations of the AWS multi-account static site infrastructure.

## Overview

These scripts help presenters prepare for professional technical demos by:
- Validating that bootstrap infrastructure is ready
- Generating presenter reference materials
- Providing consistent, repeatable demo workflows

**Note:** GitHub configuration has been moved to the bootstrap suite. See `../bootstrap/configure-github.sh` for Step 3 of the bootstrap process.

## Scripts

### `capture-bootstrap-outputs.sh`

**Purpose**: Pre-demo validation and reference generation

**When to run**: After bootstrap is complete, before starting the demo

**What it does**:
- Validates that all bootstrap steps completed successfully
- Checks for accounts.json and backend configurations
- Generates `demo-reference.txt` with infrastructure summary
- Creates talking points and key metrics for presenter

**Usage**:
```bash
./scripts/demo/capture-bootstrap-outputs.sh
```

**Output**: Creates `scripts/demo/demo-reference.txt` (local file, never committed)

**Example output validation**:
```
‚úì accounts.json found
‚úì All account IDs present (4 accounts)
‚úì Output directory found
‚úì backend-config-dev.hcl exists
‚úì backend-config-staging.hcl exists
‚úì backend-config-prod.hcl exists
‚úì Demo reference file created
```

---

### `switch-theme.sh`

**Purpose**: Easily switch between website themes for visual demo impact

**When to run**: During demos to show live deployment updates with visible changes

**What it does**:
- Detects current website theme (blue or green)
- Switches between `index-blog-v1.html` (blue) and `index-blog-v2.html` (green)
- Creates backup of current `index.html`
- Provides next steps for committing and deploying

**Usage**:
```bash
# Check current theme
./scripts/demo/switch-theme.sh status

# Switch to green theme
./scripts/demo/switch-theme.sh green

# Switch to blue theme
./scripts/demo/switch-theme.sh blue
```

**Output**:
```
‚úÖ Successfully switched to GREEN theme!

üìù Next steps:
  1. Commit the change: git add src/index.html && git commit -m 'Switch to green theme'
  2. Push to trigger deployment: git push
  3. Wait for GitHub Actions to deploy (~2-3 minutes)
  4. Visit the website URL from the workflow summary

üí° The updated workflow now:
  ‚Ä¢ Sets cache-control headers for instant updates
  ‚Ä¢ Waits for CloudFront invalidation to complete
  ‚Ä¢ Provides cache-busting URLs in the summary
```

**Theme colors**:
- Blue theme: `#2563eb` (index-blog-v1.html)
- Green theme: `#059669` (index-blog-v2.html)

**Demo impact**: Visual color changes make deployments immediately obvious to demo participants, eliminating confusion about whether the deployment actually updated.

---

## GitHub Configuration (Moved to Bootstrap Suite)

**GitHub configuration is now part of the bootstrap process** and has been relocated to:

```bash
../bootstrap/configure-github.sh
```

This script is now Step 3 of the bootstrap suite:
1. `bootstrap-organization.sh` - Create AWS Organization and accounts
2. `bootstrap-foundation.sh` - Create OIDC providers, IAM roles, and Terraform backends
3. **`configure-github.sh`** - Configure GitHub repository for CI/CD workflows

**For demo presentations**, use the relocated script:
```bash
./scripts/bootstrap/configure-github.sh
```

**What it configures:**
- AWS account IDs as GitHub variables
- OIDC role ARNs as GitHub secrets
- Infrastructure settings (regions, versions, budgets)

See `../bootstrap/configure-github.sh --help` for full documentation.

---

## Local-Only Files

These files are generated by the scripts but **never committed to git**:

```
scripts/demo/
‚îî‚îÄ‚îÄ demo-reference.txt          # Infrastructure summary for presenter
scripts/bootstrap/
‚îú‚îÄ‚îÄ accounts.json               # AWS account IDs
‚îî‚îÄ‚îÄ output/
    ‚îú‚îÄ‚îÄ backend-config-*.hcl    # Terraform backend configurations
    ‚îî‚îÄ‚îÄ *.log                   # Bootstrap execution logs
```

All these paths are in `.gitignore` to prevent accidental commits of sensitive data.

---

## Demo Workflow

### Pre-Demo Setup (Complete beforehand)

1. **Bootstrap infrastructure**:
   ```bash
   # Create AWS Organization and accounts (~8 minutes)
   ./scripts/bootstrap/bootstrap-organization.sh

   # Create OIDC, roles, and backends (~12 minutes)
   ./scripts/bootstrap/bootstrap-foundation.sh
   ```

2. **Capture outputs for reference**:
   ```bash
   # Generate demo reference materials
   ./scripts/demo/capture-bootstrap-outputs.sh

   # Review the reference file
   cat scripts/demo/demo-reference.txt
   ```

3. **Review demo agenda**:
   ```bash
   # Read the full demo agenda
   cat DEMO_AGENDA.md
   ```

### During Demo (Live execution)

1. **Configure GitHub (minute 30-32)**:
   ```bash
   # Run interactively during demo (Step 3 of bootstrap)
   ./scripts/bootstrap/configure-github.sh
   ```

2. **Create feature branch and switch theme (minute 32-34)**:
   ```bash
   # Create timestamped feature branch
   git checkout -b feature/demo-$(date +%Y%m%d-%H%M)

   # Switch to green theme for visual impact
   ./scripts/demo/switch-theme.sh green

   # Alternative: Make a small visible change
   # echo "<!-- Demo: $(date '+%Y-%m-%d %H:%M:%S') -->" >> src/index.html
   ```

3. **Trigger deployment (minute 34-38)**:
   ```bash
   # Commit and push
   git add src/index.html
   git commit -m "demo: add timestamp $(date +%H:%M)"
   git push origin feature/demo-*

   # Watch deployment in real-time
   gh run watch
   ```

4. **Verify deployment (minute 38-40)**:
   ```bash
   # Get deployment URL from workflow logs or README
   gh run view --log | grep "Website URL"

   # Test the website
   curl -I <website-url>
   ```

---

## Prerequisites

All scripts require:
- **Bash 4.0+**
- **jq** - JSON processor (`brew install jq`)
- **GitHub CLI** - Authenticated (`gh auth login`)
- **AWS CLI** - For infrastructure queries (optional)

---

## Security Considerations

### Account ID Protection

Account IDs are AWS-sensitive information. These scripts:
- ‚úÖ Read from local `accounts.json` (never committed)
- ‚úÖ Display masked account IDs in logs (e.g., `1234****5678`)
- ‚úÖ Generate reference files that are local-only
- ‚úÖ Never expose full account IDs in public repositories

### GitHub Secrets Management

The secrets configuration script:
- ‚úÖ Uses OIDC (no long-lived AWS credentials)
- ‚úÖ Sets secrets via GitHub CLI (encrypted at rest)
- ‚úÖ Verifies configuration without exposing values
- ‚úÖ Provides audit trail via gh CLI authentication

### Best Practices

1. **Never commit**:
   - `accounts.json`
   - `demo-reference.txt`
   - Any `scripts/bootstrap/output/*` files

2. **Always verify**:
   - `.gitignore` includes local files before committing
   - Scripts run with your own credentials (not shared)
   - Account IDs are masked in screen recordings

3. **Clean up after demo**:
   - Consider running destroy scripts after demo
   - Rotate credentials if accidentally exposed
   - Review CloudTrail logs for unexpected activity

---

## Troubleshooting

### "accounts.json not found"

**Cause**: Bootstrap scripts haven't been run yet

**Solution**:
```bash
./scripts/bootstrap/bootstrap-organization.sh
./scripts/bootstrap/bootstrap-foundation.sh
```

---

### "GitHub CLI not authenticated"

**Cause**: Not logged in to GitHub CLI

**Solution**:
```bash
gh auth login
# Follow prompts to authenticate
```

---

### "Backend configs missing"

**Cause**: Foundation bootstrap didn't complete successfully

**Solution**:
```bash
# Check bootstrap logs
ls -la scripts/bootstrap/output/

# Re-run foundation bootstrap
./scripts/bootstrap/bootstrap-foundation.sh
```

---

### "Secret already exists" warning

**Cause**: Secrets were previously configured

**Solution**: This is normal. The script will update existing secrets with new values. No action needed.

---

## Related Documentation

- **[DEMO_AGENDA.md](../../DEMO_AGENDA.md)** - Complete 60-minute demo agenda
- **[DEPLOYMENT.md](../../DEPLOYMENT.md)** - Full deployment guide
- **[docs/secrets-and-variables.md](../../docs/secrets-and-variables.md)** - Detailed secrets documentation
- **[scripts/bootstrap/README.md](../bootstrap/README.md)** - Bootstrap scripts documentation

---

## Contributing

When adding new demo scripts:
1. Follow existing naming conventions (`verb-noun.sh`)
2. Include comprehensive help text
3. Add validation and error handling
4. Update this README with usage documentation
5. Add generated files to `.gitignore` if they contain sensitive data

---

**Note**: These scripts are designed for demonstration purposes. For production deployments, follow the full deployment guide in [DEPLOYMENT.md](../../DEPLOYMENT.md).
